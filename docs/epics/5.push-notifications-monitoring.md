# Epic 5: Push Notifications & Real-Time Monitoring

**ID:** 5  
**Status:** Draft  
**Owner:** @ybis-team  
**Created:** 2025-10-29  
**Target:** Closed Beta Launch (Week 7)  
**Priority:** P1 (High - User Engagement Critical)

---

## 🎯 1. Epic Goal

Push notification sistemi ve real-time monitoring oluşturmak:
- ✅ EAS Build APK deployment (Expo Go → Production build)
- ✅ Firebase Cloud Messaging (FCM) integration
- ✅ Push notification triggers (task due, flow completion, calendar reminder)
- ✅ OTA updates (EAS Update for quick fixes)
- ✅ Sentry monitoring (error tracking backend + mobile)
- ✅ Performance monitoring (API latency, app startup time)

**Closed Beta Scope:**
- ✅ Firebase FCM setup (google-services.json)
- ✅ EAS Build configuration (eas.json - preview profile for APK)
- ✅ Push token registration (client → backend)
- ✅ Push notification sending (backend → Expo Push API)
- ✅ Basic triggers: Task due reminder, Flow failure notification
- ✅ Sentry integration (error tracking)
- ✅ EAS Update setup (OTA for JS-only changes)
- ❌ Advanced triggers: Calendar reminders, AI suggestions (MVP)

---

## 2. Scope (Kapsam)

### **Push Notifications (P0):**
- ✅ Firebase project setup (YBIS app)
- ✅ FCM configuration (google-services.json)
- ✅ EAS Build (APK for beta distribution)
- ✅ Push token registration flow
- ✅ Expo Push API integration (backend)
- ✅ Push triggers: Task due (1 hour before), Flow execution status
- ✅ Notification UI (foreground + background)

### **OTA Updates (P1):**
- ✅ EAS Update configuration
- ✅ Update channels (beta, production)
- ✅ Automatic update check (on app start)
- ✅ Manual update trigger (user can force update)

### **Monitoring & Observability (P1):**
- ✅ Sentry backend integration (error tracking)
- ✅ Sentry mobile integration (crash reporting)
- ✅ Performance monitoring (API response times, app startup)
- ✅ Health check dashboard (uptime, error rate)

### **NOT in Scope:**
- ❌ Calendar reminders (Epic 6 - Google Calendar)
- ❌ AI-powered notification personalization (Epic 8)
- ❌ In-app notification center (MVP)
- ❌ Notification settings/preferences (MVP)

---

## 3. User Stories (5 Stories - 23 Points)

### **Story 5.1: Firebase & EAS Build Setup (5 points)**
- Firebase project + FCM configuration
- EAS Build APK (preview profile)
- Deep link handling (ybis://auth-callback)

### **Story 5.2: Push Token Registration (3 points)**
- Client: Request permissions + get Expo push token
- Backend: Store tokens in `push_tokens` table
- Token rotation on app start

### **Story 5.3: Push Notification Backend (5 points)**
- Backend endpoint: `/api/push/notify`
- Expo Push API integration
- Batch sending (up to 100 notifications)
- Error handling (invalid tokens, rate limits)

### **Story 5.4: Push Triggers Implementation (5 points)**
- Task due trigger (1 hour before due_date)
- Flow execution status (success/failure)
- Supabase cron job or Edge Function scheduler

### **Story 5.5: Sentry Integration & OTA Updates (5 points)**
- Sentry project setup (backend + mobile)
- Error tracking integration
- Source map upload
- EAS Update configuration
- Update flow (check → download → apply)

---

## 4. Success Metrics

**Technical:**
- ✅ Push delivery success rate >95%
- ✅ Push latency <30s (trigger → delivery)
- ✅ EAS Build success rate 100%
- ✅ OTA update adoption >80% (within 24h)
- ✅ Sentry error capture rate 100% (no missed crashes)

**User:**
- ✅ 70%+ users enable push notifications
- ✅ Push notification engagement rate >50% (tap rate)
- ✅ Zero user complaints about spam

---

**Last Updated:** 2025-10-29  
**Story Points:** 23 (~3-4 hafta)

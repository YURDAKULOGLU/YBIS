# Epic 4: Flows & Workflow Automation System

**ID:** 4  
**Status:** Draft  
**Owner:** @ybis-team  
**Created:** 2025-10-29  
**Target:** Closed Beta Launch (Week 4-7)  
**Priority:** P0 (Critical - Core Value Proposition!)

---

## ğŸ¯ 1. Epic Goal

**YBIS'in kalbi:** Template-based workflow automation system oluÅŸturmak:
- âœ… Flow Engine (zamanlÄ± tetikleyiciler, koÅŸullu adÄ±mlar, loop'lar)
- âœ… Flow Templates (morning routine, daily planning, project kickoff)
- âœ… Flow Builder UI (drag-drop veya YAML-based)
- âœ… Flow Execution (background jobs, scheduled triggers)
- âœ… AI-Powered Flow Suggestions (user behavior â†’ flow recommendation)
- âœ… Flow Marketplace (community templates)

**Closed Beta Scope (Minimal MVP):**
- âœ… Flow CRUD (basic - already in Epic 3.8)
- âœ… 3-5 Pre-built Templates (morning routine, daily planning)
- âœ… Manual Flow Execution (user taps "Run")
- âœ… Scheduled Triggers (cron-based - daily, weekly)
- âœ… Flow Step Types: createTask, createNote, sendNotification, delay
- âŒ Advanced: Conditional logic, loops, AI suggestions (MVP)

**Why Critical:**
> "Flows differentiate YBIS from ChatGPT/Notion. It's automation + AI."
> Without flows, YBIS = just another chat app.

---

## 2. Scope (Kapsam)

### **Flow Engine (Core - P0):**
- âœ… Flow execution engine (step-by-step processor)
- âœ… Step registry (extensible - new step types easy to add)
- âœ… Trigger system (manual, scheduled, event-based)
- âœ… Flow state management (in_progress, completed, failed)
- âœ… Error handling (step fails â†’ retry or skip)
- âœ… Flow logs (execution history)

### **Flow Templates (P0):**
- âœ… 3-5 pre-built templates:
  1. **Morning Routine** (every day 8 AM â†’ email summary + task list)
  2. **Daily Planning** (every weekday 9 AM â†’ create daily note + priority tasks)
  3. **Weekly Review** (every Sunday 6 PM â†’ summarize week + plan next week)
  4. **Project Kickoff** (manual â†’ create project note + tasks + calendar event)
  5. **Focus Mode** (manual â†’ mute notifications + create focus note + start timer)
- âœ… Template structure: YAML-based (easy to edit, version control)
- âœ… Template variables: `{{user.name}}`, `{{today}}`, `{{workspace.name}}`

### **Flow Builder UI (P1 - Simplified):**
- âœ… Flow list screen (view all flows)
- âœ… Flow detail screen (view steps)
- âœ… Flow run button (manual execution)
- âœ… Flow logs screen (execution history)
- âŒ Drag-drop builder (MVP - too complex for beta)
- âŒ Visual flow diagram (MVP)

### **Flow Execution (P0):**
- âœ… Manual execution (user taps "Run")
- âœ… Scheduled execution (cron-based - Supabase pg_cron)
- âœ… Background jobs (async processing)
- âœ… Step execution (sequential - one step at a time)
- âœ… Error recovery (retry failed steps)
- âŒ Parallel execution (MVP)
- âŒ Conditional branching (MVP)

### **Flow Step Types (P0 - Minimal Set):**
```yaml
Step Types (Beta):
  1. createTask      â†’ Create task in database
  2. createNote      â†’ Create note in database
  3. sendNotification â†’ Push notification to user
  4. delay           â†’ Wait X minutes/hours
  5. httpRequest     â†’ Call external API (future integrations)

Future Step Types (MVP):
  6. if/else         â†’ Conditional logic
  7. loop            â†’ Repeat steps
  8. aiSuggest       â†’ AI-powered suggestions
  9. emailSend       â†’ Send email (Gmail API)
  10. calendarEvent  â†’ Create calendar event
```

### **NOT in Scope (Future Epics):**
- âŒ AI-powered flow suggestions (Epic 9 - AI Tools)
- âŒ Flow marketplace (Open Beta)
- âŒ Visual flow builder (MVP)
- âŒ Conditional logic (MVP)
- âŒ User-created custom steps (MVP)
- âŒ Flow analytics (MVP)

---

## 3. Risk Analysis

**Risk 1 (High): Flow Execution Failures â†’ User Frustration**
- Scheduled flow fails (e.g., createTask step error) â†’ user unaware
- **Mitigation:**
  - Flow logs screen (user sees all executions)
  - Push notification on flow failure
  - Retry logic (3 attempts with exponential backoff)
  - Graceful degradation (skip failed step, continue)

**Risk 2 (High): Cron Jobs Reliability (Supabase pg_cron)**
- pg_cron might fail (database downtime, trigger not firing)
- **Mitigation:**
  - Monitor cron jobs (daily health check)
  - Fallback: Edge Function cron (Vercel cron jobs)
  - Alert on missed schedules (Sentry)
  - Manual retry button (user can re-run)

**Risk 3 (Medium): Flow Template Complexity â†’ User Confusion**
- Users don't understand flow steps
- **Mitigation:**
  - Clear template descriptions (what it does, when it runs)
  - Onboarding tutorial (first flow walkthrough)
  - Pre-configured templates (no editing in beta)
  - Flow preview (before running)

**Risk 4 (Medium): Background Job Performance â†’ Slow Execution**
- Flow with 10 steps takes 30+ seconds
- **Mitigation:**
  - Optimize step execution (parallel where possible in MVP)
  - Step timeout (max 5s per step)
  - Progress indicator (user sees "Step 3/10")
  - Async execution (user doesn't wait)

**Risk 5 (Low): Template Versioning â†’ Breaking Changes**
- Template updated â†’ old flows break
- **Mitigation:**
  - Semantic versioning (template_version field)
  - Migration scripts (auto-upgrade old flows)
  - No breaking changes in beta (new features only)

---

## 4. User Stories (8 Stories)

### **Flow Engine Stories:**

---

#### **Story 4.1: Flow Execution Engine - Core Architecture**

**User Story:** Bir developer olarak, flow execution engine fully implemented olmalÄ±, bÃ¶ylece template-based workflows Ã§alÄ±ÅŸtÄ±rabilirim.

**Acceptance Criteria:**
- [ ] `packages/flows/` package created with structure:
  ```
  packages/flows/
  â”œâ”€â”€ src/
  â”‚   â”œâ”€â”€ engine/
  â”‚   â”‚   â”œâ”€â”€ FlowExecutor.ts       (main execution logic)
  â”‚   â”‚   â”œâ”€â”€ StepRegistry.ts       (available step types)
  â”‚   â”‚   â””â”€â”€ TriggerManager.ts     (manual, scheduled, event)
  â”‚   â”œâ”€â”€ steps/
  â”‚   â”‚   â”œâ”€â”€ BaseStep.ts           (abstract step class)
  â”‚   â”‚   â”œâ”€â”€ CreateTaskStep.ts
  â”‚   â”‚   â”œâ”€â”€ CreateNoteStep.ts
  â”‚   â”‚   â”œâ”€â”€ SendNotificationStep.ts
  â”‚   â”‚   â”œâ”€â”€ DelayStep.ts
  â”‚   â”‚   â””â”€â”€ HttpRequestStep.ts
  â”‚   â”œâ”€â”€ types/
  â”‚   â”‚   â”œâ”€â”€ Flow.ts
  â”‚   â”‚   â”œâ”€â”€ FlowExecution.ts
  â”‚   â”‚   â”œâ”€â”€ FlowStep.ts
  â”‚   â”‚   â””â”€â”€ FlowTrigger.ts
  â”‚   â””â”€â”€ __tests__/
  â”œâ”€â”€ package.json
  â””â”€â”€ tsconfig.json
  ```
- [ ] `FlowExecutor` class:
  - `execute(flowId: string, triggerId?: string): Promise<FlowExecution>`
  - Sequential step execution (one-by-one)
  - Error handling (step fails â†’ retry 3x â†’ skip or fail flow)
  - Flow state tracking (in_progress â†’ completed/failed)
  - Flow logs (step-level logging)
- [ ] `StepRegistry` singleton:
  - Register step types (createTask, createNote, etc.)
  - Get step executor by type
  - Validate step configuration
- [ ] `TriggerManager` class:
  - Manual trigger (user taps "Run")
  - Scheduled trigger (cron-based)
  - Event trigger (future - webhook, database change)
- [ ] Unit tests: 80%+ coverage
- [ ] Integration tests: Run sample flow end-to-end

**Technical Notes:**
- Flow execution: Async (background job)
- Step execution: Sequential (MVP - no parallel)
- Error handling: Exponential backoff (1s, 2s, 4s)
- Flow state: Store in `flow_executions` table
- Logs: Store in `flow_execution_logs` table (step_id, status, error, duration)

**Assigned To:** Dev Agent  
**Story Points:** 8  
**Priority:** P0 (Blocker)

---

#### **Story 4.2: Flow Step Types - Implementation**

**User Story:** Bir developer olarak, 5 core step types implemented olmalÄ±, bÃ¶ylece basic workflows oluÅŸturabilirim.

**Acceptance Criteria:**
- [ ] `CreateTaskStep` implemented:
  - Input: `{ title: string, status?: string, priority?: string, due_date?: string }`
  - Action: Call DatabasePort.create('tasks', data)
  - Output: Created task ID
  - Error handling: Task creation fails â†’ log error, skip step
- [ ] `CreateNoteStep` implemented:
  - Input: `{ title: string, content: string }`
  - Action: Call DatabasePort.create('notes', data)
  - Output: Created note ID
- [ ] `SendNotificationStep` implemented:
  - Input: `{ title: string, body: string }`
  - Action: Call NotificationPort.send(userId, title, body)
  - Output: Notification sent (boolean)
- [ ] `DelayStep` implemented:
  - Input: `{ duration: number, unit: 'seconds' | 'minutes' | 'hours' }`
  - Action: `await sleep(duration)`
  - Output: Delay completed
- [ ] `HttpRequestStep` implemented:
  - Input: `{ url: string, method: 'GET' | 'POST', headers?: {}, body?: {} }`
  - Action: `fetch(url, { method, headers, body })`
  - Output: Response data (JSON)
  - Error handling: Request fails â†’ retry 3x â†’ log error
- [ ] All steps extend `BaseStep` abstract class:
  ```typescript
  abstract class BaseStep {
    abstract type: string;
    abstract execute(config: any, context: FlowContext): Promise<StepResult>;
    async retry(fn: () => Promise<any>, attempts: number): Promise<any>;
  }
  ```
- [ ] Step validation: Zod schemas for each step config
- [ ] Unit tests: Each step type separately
- [ ] Integration tests: Step execution with real dependencies

**Technical Notes:**
- `FlowContext`: `{ userId, workspaceId, flowId, executionId, variables: {} }`
- `StepResult`: `{ success: boolean, output?: any, error?: string, duration: number }`
- Error handling: Log error, mark step as failed, continue or stop flow based on config
- Step timeout: Max 5s per step (configurable)

**Assigned To:** Dev Agent  
**Story Points:** 5  
**Priority:** P0 (Blocker)

---

#### **Story 4.3: Flow Templates - Pre-built Workflows**

**User Story:** Bir user olarak, 5 pre-built flow templates kullanabilmeliyim, bÃ¶ylece hÄ±zlÄ±ca workflow automation baÅŸlatabilirim.

**Acceptance Criteria:**
- [ ] Template storage: `packages/flows/src/templates/` directory
- [ ] Template format: YAML files (easy to edit, readable)
- [ ] **Template 1: Morning Routine**
  ```yaml
  name: Morning Routine
  description: Start your day with a summary of emails, calendar, and priority tasks
  trigger:
    type: scheduled
    cron: "0 8 * * *"  # Every day at 8 AM
  steps:
    - type: createNote
      config:
        title: "ğŸ“… Morning Brief - {{today}}"
        content: |
          Good morning, {{user.name}}!
          
          Today's agenda:
          - Check emails (AI summary)
          - Review calendar events
          - Top 3 priority tasks
    - type: sendNotification
      config:
        title: "Morning Routine Started"
        body: "Your daily brief is ready!"
  ```
- [ ] **Template 2: Daily Planning**
  ```yaml
  name: Daily Planning
  description: Create a structured daily plan with tasks and time blocks
  trigger:
    type: scheduled
    cron: "0 9 * * 1-5"  # Weekdays at 9 AM
  steps:
    - type: createNote
      config:
        title: "ğŸ“ Daily Plan - {{today}}"
        content: |
          ## Today's Focus
          - [ ] Top priority
          - [ ] Second priority
          - [ ] Third priority
          
          ## Time Blocks
          - 09:00-11:00: Deep work
          - 11:00-12:00: Meetings
          - 14:00-16:00: Deep work
    - type: createTask
      config:
        title: "Review daily plan"
        priority: "high"
        due_date: "{{today}}"
  ```
- [ ] **Template 3: Weekly Review**
  ```yaml
  name: Weekly Review
  description: Summarize the week and plan for next week
  trigger:
    type: scheduled
    cron: "0 18 * * 0"  # Sundays at 6 PM
  steps:
    - type: createNote
      config:
        title: "ğŸ“Š Weekly Review - Week {{week_number}}"
        content: |
          ## Completed This Week
          - [Summary of completed tasks]
          
          ## Next Week's Goals
          - [ ] Goal 1
          - [ ] Goal 2
          - [ ] Goal 3
    - type: sendNotification
      config:
        title: "Weekly Review Ready"
        body: "Time to reflect and plan!"
  ```
- [ ] **Template 4: Project Kickoff**
  ```yaml
  name: Project Kickoff
  description: Set up a new project with notes, tasks, and calendar event
  trigger:
    type: manual
  variables:
    - name: project_name
      type: string
      required: true
    - name: deadline
      type: date
      required: false
  steps:
    - type: createNote
      config:
        title: "ğŸ“ {{project_name}} - Project Plan"
        content: |
          ## Project: {{project_name}}
          Deadline: {{deadline}}
          
          ## Phases
          1. Planning
          2. Execution
          3. Review
    - type: createTask
      config:
        title: "Define {{project_name}} requirements"
        priority: "high"
    - type: createTask
      config:
        title: "Create {{project_name}} timeline"
        priority: "medium"
  ```
- [ ] **Template 5: Focus Mode**
  ```yaml
  name: Focus Mode
  description: Enter deep work mode with muted notifications and focus timer
  trigger:
    type: manual
  steps:
    - type: sendNotification
      config:
        title: "Focus Mode Activated"
        body: "Notifications muted for 90 minutes"
    - type: createNote
      config:
        title: "ğŸ¯ Focus Session - {{now}}"
        content: |
          ## Focus Goal
          [What are you focusing on?]
          
          Duration: 90 minutes
          Start: {{now}}
    - type: delay
      config:
        duration: 90
        unit: "minutes"
    - type: sendNotification
      config:
        title: "Focus Mode Ended"
        body: "Great work! Time for a break."
  ```
- [ ] Template loader: Load templates into database on app start
- [ ] Template variables: Support `{{variable}}` syntax
- [ ] Template validation: Zod schema for template structure
- [ ] Mobile UI: Template gallery (view, preview, activate)

**Technical Notes:**
- Template variables: Replace at execution time
- Built-in variables: `{{user.name}}`, `{{today}}`, `{{now}}`, `{{week_number}}`
- User variables: Prompt user for input (project_name, deadline)
- Template versioning: `template_version: 1.0.0` field

**Assigned To:** Dev Agent  
**Story Points:** 5  
**Priority:** P0 (Critical - Showcase Feature!)

---

#### **Story 4.4: Scheduled Triggers - Cron-Based Execution**

**User Story:** Bir user olarak, flows otomatik olarak scheduled time'da Ã§alÄ±ÅŸmalÄ± (every day 8 AM, weekdays 9 AM, etc.).

**Acceptance Criteria:**
- [ ] Database table: `flow_triggers`
  ```sql
  CREATE TABLE flow_triggers (
    id UUID PRIMARY KEY,
    flow_id UUID REFERENCES flows(id),
    workspace_id UUID REFERENCES workspaces(id),
    trigger_type TEXT CHECK (trigger_type IN ('manual', 'scheduled', 'event')),
    cron_expression TEXT, -- For scheduled triggers
    enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ,
    updated_at TIMESTAMPTZ
  );
  ```
- [ ] Supabase pg_cron setup:
  ```sql
  -- Create cron job to check scheduled triggers every minute
  SELECT cron.schedule(
    'run-scheduled-flows',
    '* * * * *',  -- Every minute
    $$
    SELECT run_scheduled_flows();
    $$
  );
  ```
- [ ] Database function: `run_scheduled_flows()`
  ```sql
  CREATE OR REPLACE FUNCTION run_scheduled_flows()
  RETURNS void AS $$
  BEGIN
    -- Find triggers due to run (cron expression matches current time)
    -- Call Edge Function to execute flow
  END;
  $$ LANGUAGE plpgsql;
  ```
- [ ] Edge Function: `/api/flows/execute`
  - Endpoint: `POST /api/flows/:flowId/execute`
  - Body: `{ triggerId: string }`
  - Action: Call FlowExecutor.execute(flowId, triggerId)
  - Response: `{ executionId: string, status: 'in_progress' }`
- [ ] Cron expression parser (use `cron-parser` npm package)
- [ ] Health check: Monitor cron jobs (daily notification if no flows executed)
- [ ] Mobile UI: Enable/disable scheduled flows
- [ ] Manual retry: User can manually trigger scheduled flows

**Technical Notes:**
- pg_cron: Supabase extension (enable via dashboard)
- Cron expressions: Standard syntax (`* * * * *` = minute hour day month weekday)
- Edge Function auth: Service role key (bypass RLS)
- Execution tracking: Store in `flow_executions` table
- Failed execution: Retry next schedule time (no immediate retry)

**Assigned To:** Dev Agent  
**Story Points:** 5  
**Priority:** P0 (Blocker)

---

### **Flow UI Stories:**

---

#### **Story 4.5: Flow List Screen**

**User Story:** Bir user olarak, tÃ¼m flow'larÄ±mÄ± gÃ¶rebilmeli (template + custom) ve yÃ¶netebilmeliyim.

**Acceptance Criteria:**
- [ ] Screen: `apps/mobile/src/screens/FlowsScreen.tsx`
- [ ] UI sections:
  - **Templates** (pre-built, badge: "Template")
  - **My Flows** (user-activated templates, badge: "Active")
- [ ] Flow card:
  - Title
  - Description (1 line)
  - Trigger type (Manual / Scheduled)
  - Last run time
  - Status badge (Active / Paused / Failed)
  - Actions: Run, View, Edit (future), Delete
- [ ] Tap flow card â†’ Navigate to Flow Detail screen
- [ ] Tap "Run" button â†’ Execute flow immediately (manual trigger)
- [ ] Empty state: "No flows yet. Activate a template!"
- [ ] Loading state: Skeleton cards
- [ ] Error state: Retry button

**Technical Notes:**
- Use DatabasePort to fetch flows
- Realtime subscription: New flow â†’ UI update
- Filter: Show only user's workspace flows
- Sorting: Last run time (desc)

**Assigned To:** Dev Agent  
**Story Points:** 3  
**Priority:** P1 (High)

---

#### **Story 4.6: Flow Detail Screen**

**User Story:** Bir user olarak, flow detaylarÄ±nÄ± gÃ¶rebilmeli (steps, trigger, logs).

**Acceptance Criteria:**
- [ ] Screen: `apps/mobile/src/screens/FlowDetailScreen.tsx`
- [ ] UI sections:
  - **Flow Info:** Title, Description, Trigger type
  - **Steps:** List of steps (with icons, titles, configs)
  - **Execution Logs:** Last 10 executions (status, start time, duration)
  - **Actions:** Run, Edit (future), Delete, Enable/Disable
- [ ] Step card:
  - Icon (based on step type)
  - Title (e.g., "Create Task")
  - Config preview (e.g., "Title: Review daily plan")
- [ ] Tap step â†’ Show full config (modal)
- [ ] Execution log card:
  - Status badge (Success / Failed / In Progress)
  - Start time (relative: "2 hours ago")
  - Duration (e.g., "3.2s")
  - Tap â†’ View detailed logs (step-by-step)
- [ ] "Run" button: Execute flow immediately
- [ ] "Delete" button: Confirm dialog â†’ Delete flow
- [ ] Enable/Disable toggle: Pause/resume scheduled flows

**Technical Notes:**
- Use DatabasePort to fetch flow + execution logs
- Realtime subscription: New execution â†’ UI update
- Step icons: Map step type to icon (createTask â†’ CheckSquare, createNote â†’ FileText)
- Detailed logs: Show step-level logs (step name, status, output, error, duration)

**Assigned To:** Dev Agent  
**Story Points:** 5  
**Priority:** P1 (High)

---

#### **Story 4.7: Flow Template Gallery**

**User Story:** Bir user olarak, pre-built templates'i gÃ¶rebilmeli, preview yapabilmeli, ve activate edebilmeliyim.

**Acceptance Criteria:**
- [ ] Screen: `apps/mobile/src/screens/FlowTemplateGalleryScreen.tsx`
- [ ] UI sections:
  - **Featured Templates** (5 pre-built)
  - **Category filters** (Productivity, Planning, Project Management)
- [ ] Template card:
  - Title
  - Description
  - Trigger type badge (Manual / Daily / Weekly)
  - Preview button
  - Activate button
- [ ] Tap "Preview" â†’ Modal with:
  - Full description
  - Step list (with icons and titles)
  - Example output (screenshot or text)
  - "Activate" button
- [ ] Tap "Activate" â†’ Create flow from template:
  - Prompt for variables (if any)
  - Create flow in database
  - Navigate to Flow Detail screen
  - Show success toast: "Flow activated!"
- [ ] Empty state: "No templates available"
- [ ] Loading state: Skeleton cards

**Technical Notes:**
- Templates: Load from `packages/flows/src/templates/`
- Template activation: Copy template â†’ Create flow in user's workspace
- Variables: If template has variables, show input modal
- Category filters: Tag templates with categories (productivity, planning, etc.)

**Assigned To:** Dev Agent  
**Story Points:** 5  
**Priority:** P1 (High)

---

### **Flow Execution Stories:**

---

#### **Story 4.8: Background Flow Execution & Monitoring**

**User Story:** Bir developer olarak, flows background'da execute edilmeli, progress trackable olmalÄ±, ve errors monitored olmalÄ±.

**Acceptance Criteria:**
- [ ] Database table: `flow_executions`
  ```sql
  CREATE TABLE flow_executions (
    id UUID PRIMARY KEY,
    flow_id UUID REFERENCES flows(id),
    workspace_id UUID REFERENCES workspaces(id),
    trigger_id UUID REFERENCES flow_triggers(id),
    status TEXT CHECK (status IN ('in_progress', 'completed', 'failed')),
    started_at TIMESTAMPTZ,
    completed_at TIMESTAMPTZ,
    duration_ms INTEGER,
    error TEXT,
    created_at TIMESTAMPTZ
  );
  ```
- [ ] Database table: `flow_execution_logs`
  ```sql
  CREATE TABLE flow_execution_logs (
    id UUID PRIMARY KEY,
    execution_id UUID REFERENCES flow_executions(id),
    step_id UUID,
    step_type TEXT,
    step_index INTEGER,
    status TEXT CHECK (status IN ('pending', 'running', 'success', 'failed', 'skipped')),
    output JSONB,
    error TEXT,
    duration_ms INTEGER,
    created_at TIMESTAMPTZ
  );
  ```
- [ ] Background job processing:
  - Edge Function: `/api/flows/execute` (async)
  - Execute flow steps sequentially
  - Update execution status after each step
  - Log step-level details
- [ ] Progress tracking:
  - Realtime subscription to `flow_executions` table
  - Mobile UI shows progress: "Step 3/5"
  - Progress indicator (linear or circular)
- [ ] Error handling:
  - Step fails â†’ Retry 3x with exponential backoff
  - Retry fails â†’ Log error, skip step (if configured)
  - Critical step fails â†’ Stop flow execution
  - Non-critical step fails â†’ Continue to next step
- [ ] Monitoring:
  - Sentry integration (log flow execution errors)
  - Flow failure notification (push to user)
  - Daily summary: "X flows executed, Y failed"
- [ ] Performance optimization:
  - Step timeout: Max 5s per step
  - Flow timeout: Max 5 minutes total
  - Parallel execution (future - MVP sequential only)

**Technical Notes:**
- Background execution: Use Edge Function (Vercel cron or manual trigger)
- Realtime: Use Supabase `postgres_changes` subscription
- Error types: `step_error`, `timeout_error`, `network_error`
- Retry logic: Exponential backoff (1s, 2s, 4s)
- Monitoring: Sentry `captureException` for flow errors

**Assigned To:** Dev Agent  
**Story Points:** 8  
**Priority:** P0 (Blocker)

---

## 5. Success Metrics

**Technical Metrics:**
- âœ… Flow execution success rate >95%
- âœ… Average flow execution time <30s
- âœ… Step execution success rate >98%
- âœ… Scheduled trigger reliability >99% (missed <1%)
- âœ… Zero critical flow execution errors

**User Metrics:**
- âœ… 80%+ users activate at least 1 template
- âœ… 50%+ users activate 2+ templates
- âœ… Average 3 flows per user
- âœ… Flow execution frequency: 5+ per user per week
- âœ… User satisfaction with flows >4.5/5

**Business Metrics:**
- âœ… Flows = #1 feature in beta feedback
- âœ… 70%+ users say flows are "very useful"
- âœ… NPS increase after using flows (+20 points)

---

## 6. Dependencies & Blockers

**Dependencies:**
- âœ… Epic 3: Backend Foundation (DatabasePort, API)
- âœ… Story 3.2: Database Schema (flows table already created)
- âœ… Story 3.8: Flows API (CRUD endpoints)
- âœ… Supabase pg_cron extension enabled

**Blockers:**
- âŒ None

**Enables:**
- Epic 9: AI Tool Calling (AI can suggest flows)
- Open Beta: Flow Marketplace (community templates)
- MVP: Visual Flow Builder (drag-drop)

---

## 7. Related Documents

- Vision: `docs/vision/PROJECT_VISION.md` (Plugin System section)
- Architecture: `docs/GÃ¼ncel/Architecture_better.md`
- PRD: `docs/prd/PRODUCT_REQUIREMENTS.md`
- Epic 3: Backend Foundation (flows table, API)

---

## 8. Future Enhancements (NOT in Beta!)

**MVP Features (Month 4+):**
- [ ] Conditional logic (if/else steps)
- [ ] Loop steps (repeat X times)
- [ ] AI-powered flow suggestions (based on user behavior)
- [ ] Visual flow builder (drag-drop UI)
- [ ] User-created custom steps
- [ ] Flow marketplace (share templates)
- [ ] Flow analytics (most used, success rate)
- [ ] Flow versioning (edit without breaking active flows)
- [ ] Parallel step execution (performance)
- [ ] Flow dependencies (trigger flow B after flow A)

**Open Beta Features (Month 2-3):**
- [ ] More step types (emailSend, calendarEvent, etc.)
- [ ] Event-based triggers (webhook, database change)
- [ ] Flow sharing (team collaboration)
- [ ] Flow import/export (YAML)

---

**Last Updated:** 2025-10-29 09:38 UTC  
**Version:** 1.0.0  
**Status:** COMPREHENSIVE - READY FOR IMPLEMENTATION

---

## ğŸ“ **Key Takeaways:**

**Why Flows Matter:**
> "Without flows, YBIS is just another chat app. With flows, YBIS is a productivity automation platform."

**Beta Scope:**
- âœ… 5 pre-built templates (morning routine, daily planning, etc.)
- âœ… Manual + Scheduled triggers
- âœ… 5 step types (createTask, createNote, sendNotification, delay, httpRequest)
- âœ… Flow execution engine (background, sequential)
- âœ… Flow UI (list, detail, template gallery)
- âŒ NO visual builder, conditional logic, AI suggestions (MVP)

**Story Points:** 44 points (~6-7 hafta solo dev)

---

**READY TO IMPLEMENT!** ğŸš€

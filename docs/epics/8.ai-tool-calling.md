# Epic 8: AI Tool Calling System

**ID:** 8  
**Status:** Draft  
**Owner:** @ybis-team  
**Created:** 2025-10-29  
**Target:** Closed Beta Launch (Week 6-7)  
**Priority:** P0 (Critical - Core AI Value)

---

## 🎯 1. Epic Goal

AI-powered tool calling sistemi oluşturmak:
- ✅ LLMPort function calling support (OpenAI tools parameter)
- ✅ Tool registry (extensible - easy to add new tools)
- ✅ Core tools: createTask, createNote, searchNotes, addCalendarEvent, queryRAG
- ✅ Tool execution feedback (loading, success, error)
- ✅ AppActionPort (AI → app control)
- ✅ Natural language workflow ("Add task X and create note Y")

**Closed Beta Scope:**
- ✅ LLMPort function calling interface
- ✅ OpenAI function calling integration
- ✅ 5 core tools: createTask, createNote, searchNotes, addCalendarEvent, queryRAG
- ✅ Tool registry + executor pattern
- ✅ Tool execution UI feedback (chat bubbles)
- ❌ Advanced: Multi-step workflows, conditional logic (Epic 4 Flows)
- ❌ AI suggestions: Proactive tool usage (MVP)

---

## 2. Scope (Kapsam)

### **Tool Calling Infrastructure (P0):**
- ✅ LLMPort interface update (callWithTools method)
- ✅ OpenAI function calling integration
- ✅ Tool registry pattern (register, get, execute)
- ✅ Tool executor (invoke tool, handle result)
- ✅ Tool schemas (Zod validation)

### **Core Tools (P0):**
```yaml
Tool 1: createTask
  Description: Create a new task
  Parameters: { title, priority?, due_date? }
  Action: Call DatabasePort.create('tasks', data)

Tool 2: createNote
  Description: Create a new note
  Parameters: { title, content }
  Action: Call DatabasePort.create('notes', data)

Tool 3: searchNotes
  Description: Search notes by keyword
  Parameters: { query }
  Action: Call DatabasePort.query('notes', { search: query })

Tool 4: addCalendarEvent
  Description: Add event to Google Calendar
  Parameters: { title, start, end, description? }
  Action: Call CalendarPort.createEvent(data)

Tool 5: queryRAG
  Description: Search uploaded documents
  Parameters: { query }
  Action: Call RAGPort.query(query)
```

### **Tool Execution Flow (P0):**
- ✅ User message → LLM decides tool usage
- ✅ LLM returns tool call(s) (function name + params)
- ✅ Tool executor validates params (Zod)
- ✅ Tool executor calls appropriate port method
- ✅ Tool result → Inject back to LLM
- ✅ LLM generates final response with tool results

### **Tool Execution UI (P1):**
- ✅ Chat bubble: "Creating task..." (loading)
- ✅ Chat bubble: "Task created: [title]" (success)
- ✅ Chat bubble: "Error: [message]" (error)
- ✅ Expandable details (show tool params, result)

### **NOT in Scope:**
- ❌ Multi-step workflows (use Epic 4 Flows)
- ❌ Conditional tool calling (if/else)
- ❌ User confirmation for sensitive tools (MVP)
- ❌ Tool analytics (usage stats)
- ❌ Custom user-defined tools (MVP)

---

## 3. User Stories (5 Stories - 27 Points)

### **Story 8.1: LLMPort Function Calling (8 points)**
- Update LLMPort interface (callWithTools method)
- OpenAI function calling integration
- Tool schema definition (Zod)
- Function call parsing (extract name, params)
- Error handling (invalid tool, invalid params)

### **Story 8.2: Tool Registry & Executor (5 points)**
- Tool registry class (singleton)
- Register tool (name, schema, executor)
- Get tool by name
- Tool executor: validate params → call port → return result
- Tool result types (success, error)

### **Story 8.3: Core Tools Implementation (8 points)**
- createTask tool (params → DatabasePort)
- createNote tool (params → DatabasePort)
- searchNotes tool (query → DatabasePort)
- addCalendarEvent tool (params → CalendarPort)
- queryRAG tool (query → RAGPort)
- Unit tests for each tool

### **Story 8.4: Tool Execution Flow (4 points)**
- Chat backend: Detect tool call from LLM
- Tool executor: Invoke tool → Get result
- Inject tool result back to LLM
- LLM final response generation
- Chat UI: Display tool execution feedback

### **Story 8.5: Tool Execution UI Feedback (2 points)**
- Loading state: "Creating task..." bubble
- Success state: "Task created: [title]" bubble
- Error state: "Error: [message]" bubble
- Expandable details: Show tool params + result

---

## 4. Example Conversations

**Example 1: Single Tool**
```
User: "Add a task to review the proposal by tomorrow"
AI: [Calls createTask tool]
    Tool: createTask({ title: "Review proposal", due_date: "2025-10-30" })
    Result: { success: true, taskId: "task-123" }
AI: "✅ I've created a task 'Review proposal' with a due date of tomorrow."
```

**Example 2: Multiple Tools**
```
User: "Create a note about the meeting and add it to calendar for 3 PM"
AI: [Calls createNote + addCalendarEvent tools]
    Tool 1: createNote({ title: "Meeting Notes", content: "..." })
    Tool 2: addCalendarEvent({ title: "Meeting", start: "2025-10-29T15:00" })
    Results: Both success
AI: "✅ I've created a note 'Meeting Notes' and added a calendar event at 3 PM."
```

**Example 3: Search + Create**
```
User: "Find notes about the project and create a summary task"
AI: [Calls searchNotes + createTask tools]
    Tool 1: searchNotes({ query: "project" })
    Result: [3 notes found]
    Tool 2: createTask({ title: "Summarize project notes" })
AI: "I found 3 notes about the project and created a task to summarize them."
```

---

## 5. Success Metrics

**Technical:**
- ✅ Tool call success rate >95%
- ✅ Tool execution latency <3s
- ✅ Tool param validation accuracy 100%
- ✅ Zero tool execution errors (crash)

**User:**
- ✅ 80%+ users use tool calling (at least once)
- ✅ Average 5 tool calls per user per day
- ✅ Tool calling satisfaction >4.5/5
- ✅ Most used tool: createTask (60%+)

**AI Quality:**
- ✅ Tool selection accuracy >90% (correct tool chosen)
- ✅ Parameter extraction accuracy >85%

---

**Last Updated:** 2025-10-29  
**Story Points:** 27 (~4 hafta)

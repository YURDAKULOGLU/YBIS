# Epic 8: AI Tool Calling System

**ID:** 8  
**Status:** Draft  
**Owner:** @ybis-team  
**Created:** 2025-10-29  
**Target:** Closed Beta Launch (Week 6-7)  
**Priority:** P0 (Critical - Core AI Value)

---

## ðŸŽ¯ 1. Epic Goal

AI-powered tool calling sistemi oluÅŸturmak:
- âœ… LLMPort function calling support (OpenAI tools parameter)
- âœ… Tool registry (extensible - easy to add new tools)
- âœ… Core tools: createTask, createNote, searchNotes, addCalendarEvent, queryRAG
- âœ… Tool execution feedback (loading, success, error)
- âœ… AppActionPort (AI â†’ app control)
- âœ… Natural language workflow ("Add task X and create note Y")

**Closed Beta Scope:**
- âœ… LLMPort function calling interface
- âœ… OpenAI function calling integration
- âœ… 5 core tools: createTask, createNote, searchNotes, addCalendarEvent, queryRAG
- âœ… Tool registry + executor pattern
- âœ… Tool execution UI feedback (chat bubbles)
- âŒ Advanced: Multi-step workflows, conditional logic (Epic 4 Flows)
- âŒ AI suggestions: Proactive tool usage (MVP)

---

## 2. Scope (Kapsam)

### **Tool Calling Infrastructure (P0):**
- âœ… LLMPort interface update (callWithTools method)
- âœ… OpenAI function calling integration
- âœ… Tool registry pattern (register, get, execute)
- âœ… Tool executor (invoke tool, handle result)
- âœ… Tool schemas (Zod validation)

### **Core Tools (P0):**
```yaml
Tool 1: createTask
  Description: Create a new task
  Parameters: { title, priority?, due_date? }
  Action: Call DatabasePort.create('tasks', data)

Tool 2: createNote
  Description: Create a new note
  Parameters: { title, content }
  Action: Call DatabasePort.create('notes', data)

Tool 3: searchNotes
  Description: Search notes by keyword
  Parameters: { query }
  Action: Call DatabasePort.query('notes', { search: query })

Tool 4: addCalendarEvent
  Description: Add event to Google Calendar
  Parameters: { title, start, end, description? }
  Action: Call CalendarPort.createEvent(data)

Tool 5: queryRAG
  Description: Search uploaded documents
  Parameters: { query }
  Action: Call RAGPort.query(query)
```

### **Tool Execution Flow (P0):**
- âœ… User message â†’ LLM decides tool usage
- âœ… LLM returns tool call(s) (function name + params)
- âœ… Tool executor validates params (Zod)
- âœ… Tool executor calls appropriate port method
- âœ… Tool result â†’ Inject back to LLM
- âœ… LLM generates final response with tool results

### **Tool Execution UI (P1):**
- âœ… Chat bubble: "Creating task..." (loading)
- âœ… Chat bubble: "Task created: [title]" (success)
- âœ… Chat bubble: "Error: [message]" (error)
- âœ… Expandable details (show tool params, result)

### **NOT in Scope:**
- âŒ Multi-step workflows (use Epic 4 Flows)
- âŒ Conditional tool calling (if/else)
- âŒ User confirmation for sensitive tools (MVP)
- âŒ Tool analytics (usage stats)
- âŒ Custom user-defined tools (MVP)

---

## 3. User Stories (5 Stories - 27 Points)

### **Story 8.1: LLMPort Function Calling (8 points)**
- Update LLMPort interface (callWithTools method)
- OpenAI function calling integration
- Tool schema definition (Zod)
- Function call parsing (extract name, params)
- Error handling (invalid tool, invalid params)

### **Story 8.2: Tool Registry & Executor (5 points)**
- Tool registry class (singleton)
- Register tool (name, schema, executor)
- Get tool by name
- Tool executor: validate params â†’ call port â†’ return result
- Tool result types (success, error)

### **Story 8.3: Core Tools Implementation (8 points)**
- createTask tool (params â†’ DatabasePort)
- createNote tool (params â†’ DatabasePort)
- searchNotes tool (query â†’ DatabasePort)
- addCalendarEvent tool (params â†’ CalendarPort)
- queryRAG tool (query â†’ RAGPort)
- Unit tests for each tool

### **Story 8.4: Tool Execution Flow (4 points)**
- Chat backend: Detect tool call from LLM
- Tool executor: Invoke tool â†’ Get result
- Inject tool result back to LLM
- LLM final response generation
- Chat UI: Display tool execution feedback

### **Story 8.5: Tool Execution UI Feedback (2 points)**
- Loading state: "Creating task..." bubble
- Success state: "Task created: [title]" bubble
- Error state: "Error: [message]" bubble
- Expandable details: Show tool params + result

---

## 4. Example Conversations

**Example 1: Single Tool**
```
User: "Add a task to review the proposal by tomorrow"
AI: [Calls createTask tool]
    Tool: createTask({ title: "Review proposal", due_date: "2025-10-30" })
    Result: { success: true, taskId: "task-123" }
AI: "âœ… I've created a task 'Review proposal' with a due date of tomorrow."
```

**Example 2: Multiple Tools**
```
User: "Create a note about the meeting and add it to calendar for 3 PM"
AI: [Calls createNote + addCalendarEvent tools]
    Tool 1: createNote({ title: "Meeting Notes", content: "..." })
    Tool 2: addCalendarEvent({ title: "Meeting", start: "2025-10-29T15:00" })
    Results: Both success
AI: "âœ… I've created a note 'Meeting Notes' and added a calendar event at 3 PM."
```

**Example 3: Search + Create**
```
User: "Find notes about the project and create a summary task"
AI: [Calls searchNotes + createTask tools]
    Tool 1: searchNotes({ query: "project" })
    Result: [3 notes found]
    Tool 2: createTask({ title: "Summarize project notes" })
AI: "I found 3 notes about the project and created a task to summarize them."
```

---

## 5. Success Metrics

**Technical:**
- âœ… Tool call success rate >95%
- âœ… Tool execution latency <3s
- âœ… Tool param validation accuracy 100%
- âœ… Zero tool execution errors (crash)

**User:**
- âœ… 80%+ users use tool calling (at least once)
- âœ… Average 5 tool calls per user per day
- âœ… Tool calling satisfaction >4.5/5
- âœ… Most used tool: createTask (60%+)

**AI Quality:**
- âœ… Tool selection accuracy >90% (correct tool chosen)
- âœ… Parameter extraction accuracy >85%

---

**Last Updated:** 2025-10-29  
**Story Points:** 27 (~4 hafta)
